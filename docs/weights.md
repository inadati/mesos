---
title: Apache Mesos - Weights
layout: documentation
---

# ウェイト
Mesosでは、ウェイトを使用して、異なる[ロール](roles.md)に提供されるクラスタリソースの相対的なシェアを制御することができます。

Mesos 0.28およびそれ以前のバージョンでは、ウェイトはMesosマスターの起動時に`--weights`コマンドラインフラグを指定することでのみ設定できます。ロールに`--weights`フラグで指定されたウェイトがない場合は、デフォルト値（1.0）が使用されます。フラグを更新してすべてのMesosマスターを再起動しない限り、ウェイトを変更することはできません。

Mesos 1.0 には [/weights](endpoints/master/weights.md) オペレータエンドポイントが含まれており、実行時にウェイトを変更することができます。`--weights` コマンドラインフラグは非推奨です。

# オペレーター HTTPエンドポイント
master `/weights` HTTPエンドポイントは、オペレーターがウェイトの設定を行えるようにします。このエンドポイントは現在、RESTライクなインターフェースを提供しており、以下の操作をサポートしています。:
* PUTによるウェイトの[Update](#putRequest)。
* GETで現在設定されているウェイトの[Query](#getRequest)。

エンドポイントは、オプションで認証と認可を使用できます。詳しくは、[認証ガイド](authentication.md)をご覧ください。

<a name="putRequest"></a>
## Update
オペレーターがウェイトを更新するには、`/weights`エンドポイントにHTTP PUTリクエストを送信します。

`/weights`エンドポイントへのリクエストの例は、以下のようになります（以下のJSONファイルを使用）。:

    $ curl -d @weights.json -X PUT http://<master-ip>:<port>/weights

例えば、`role1`に`2.0`のウェイトを設定し、`role2`に`3.5`のウェイトを設定する場合、オペレータは以下の`weights.json`を使用できます。:

        [
          {
            "role": "role1",
            "weight": 2.0
          },
          {
            "role": "role2",
            "weight": 3.5
          }
        ]

マスターに明示的なロールホワイトリストが設定されている場合、指定されたすべてのロールが[ロールホワイトリスト](roles.md)に存在する場合にのみ要求が有効になります。

クラスタの起動時および更新後に、ウェイトがレジストリに永続化されるようになりました。ウェイトがレジストリに永続化されると、その後`--weights`が指定されたまま起動したMesosマスターは警告を発し、代わりにレジストリ値を使用します。

オペレータには、次のいずれかのHTTP応答コードが表示されます。:
* `200 OK: Success`:（アップデート要求が成功した）。
* `400 BadRequest`: 無効な引数（無効なJSON、正のウェイトでないなど）。
* `401 Unauthorized`: 認証されていません。認証されていないリクエストです。
* `403 Forbidden`: 認証されていないリクエストです。

<a name="getRequest"></a>
## Query

オペレーターは、`/weights`エンドポイントにHTTP GETリクエストを送信することで、設定されたウェイトを問い合わせることができます。

    $ curl -X GET http://<master-ip>:<port>/weights

応答メッセージボディには、例えば、現在設定されているウェイトのJSON表現が含まれています。:

        [
          {
            "role": "role2",
            "weight": 3.5
          },
          {
            "role": "role1",
            "weight": 2.0
          }
        ]

オペレーターは以下のいずれかのHTTPレスポンスコードを受け取ります。:

* `200 OK`: 成功です。
* `401 Unauthorized`: 認証されていないリクエストです。
