---
title: Apache Mesos - Downgrade Compatibility
layout: documentation
---

# Mesosのダウングレード

このドキュメントは、既存のMesosクラスターを以前のバージョンにダウングレードしたいユーザー向けのガイドです。これは通常、問題のあるアップグレードからロールバックする際に発生します。Mesosは、新機能を使用しない限り、どの1.xバージョンと1.yバージョンのマスター/エージェント間でも互換性があります。Mesos 1.8からは、マスターの最小機能のチェックを導入しました。下位互換性のない機能が使用された場合、対応する最小能力エントリがレジストリに永続化されます。古いマスター（ケイパビリティを保有していない）がレジストリから回復しようとすると（ロールバック時など）、不足しているケイパビリティを含むエラーメッセージが表示されます。このドキュメントでは、これらの最小ケイパビリティに関する詳細な情報と、ダウングレードエラーの修正方法について説明します。


## マスターの最小容量の一覧

<table class="table table-striped">
<thead>
<tr><th>機能</th><th>説明</th>
</thead>

<tr>
  <td>
    <code>AGENT_DRAINING</code>
  </td>
  <td>
    この能力は、任意のエージェントがドレインまたは非活性化のためにマークされているときに必要です。これらの状態はMesos 1.9で追加され、<code>DRAIN_AGENT</code>または<code>DEACTIVATE_AGENT</code>オペレーターAPIを使用してトリガーされます。
この最小能力要件を削除するには:
    <ol>
      <li>
        マスターのダウングレードを停止して、より新しいバージョンに戻すことができます。
      </li>
      <li>
        ドレインマークがついている、または無効化されているエージェントをすべて見つけます。これは、<code>GET_AGENTS</code> オペレータ API を使用して、各エージェントの <code>deactivated</code> boolean フィールドをチェックすることで可能です。ドレイン中のエージェントもすべて非活性化されます。
      </li>
      <li>
        非活性化された各エージェントに対して、<code>REACTIVATE_AGENT</code>オペレーターAPIを使用します。
      </li>
    </ol>
  </td>
</tr>

<tr>
  <td>
    <code>QUOTA_V2</code>
  </td>
  <td>
    このケイパビリティは、Mesos 1.9以降でquotaが設定されたときに必要となります。この場合、新しく設定されたquotaは、デコードにこのケイパビリティを必要とするレジストリの<code>quota_configs</code>フィールドに永続化されます。
この最小能力要件を削除するには:
    <ol>
      <li>
        マスターのダウングレードを停止して、より新しいバージョンに戻すことができます。
      </li>
      <li>
        <code>/registrar(id)/registry</code>エンドポイントを使用してレジストリの内容を読み取り、<code>quota_configs</code>フィールドに記載されているロールを特定します。
      </li>
      <li>
        これらのロールのクォータをデフォルトに戻します（保証も制限もありません）。これにより、<code>quota_configs</code>フィールドからロールが削除されます。<code>quota_configs</code>が空になると、能力要件が削除されます。
      </li>
    </ol>
  </td>
</tr>
</table>
